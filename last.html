<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 èŒåœºæœ¬å‘½äººæ ¼ç¡®è¯ŠæŠ¥å‘Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background: #0b1120; color: #e2e8f0; }
        .glass-panel { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        /* å¢åŠ æµ·æŠ¥ç”Ÿæˆæ—¶çš„æ ·å¼ä¿®æ­£ */
        #poster-container { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-slate-900">
    
    <header class="relative z-10 h-14 flex items-center justify-between px-6 border-b border-white/5 bg-slate-900/50">
        <div class="font-black text-lg text-blue-500">MIND_LAB</div>
        <div class="text-xs text-slate-500">v5.0 Viral</div>
    </header>

    <main class="relative z-10 flex-1 flex flex-col items-center justify-center p-4">
        
        <div id="start-screen" class="text-center space-y-8 max-w-lg">
            <h1 class="text-5xl font-black text-white leading-tight">æµ‹æµ‹ä½ çš„<br><span class="text-blue-500">èŒåœºå‡ºå‚è®¾ç½®</span></h1>
            <p class="text-slate-400">Gallupä¼˜åŠ¿ç®—æ³• Ã— MBTIå†…æ ¸</p>
            <button onclick="startQuiz()" class="px-10 py-4 bg-blue-600 text-white rounded-full font-bold shadow-lg shadow-blue-600/30">ç«‹å³ç¡®è¯Š</button>
        </div>

        <div id="quiz-screen" class="hidden w-full max-w-xl h-[70vh] flex flex-col glass-panel rounded-2xl overflow-hidden">
            <div class="w-full bg-slate-800 h-1"><div id="progress-bar" class="bg-blue-500 h-full transition-all duration-300" style="width: 0%"></div></div>
            <div class="flex-1 overflow-y-auto p-8">
                <div class="text-xs text-blue-400 font-mono mb-4">QUESTION <span id="q-index">1</span></div>
                <h2 id="q-text" class="text-2xl font-bold text-white mb-8">...</h2>
                <div class="space-y-4">
                    <button onclick="selectOption('A')" class="w-full p-4 text-left border border-white/10 rounded-xl hover:bg-white/5 text-slate-200 transition-all"><span class="text-xs text-slate-500 block mb-1">A</span><span id="text-a">...</span></button>
                    <button onclick="selectOption('B')" class="w-full p-4 text-left border border-white/10 rounded-xl hover:bg-white/5 text-slate-200 transition-all"><span class="text-xs text-slate-500 block mb-1">B</span><span id="text-b">...</span></button>
                </div>
            </div>
        </div>

        <div id="result-screen" class="hidden absolute inset-0 bg-slate-900 z-50 overflow-y-auto">
            <div class="min-h-screen flex items-center justify-center p-4">
                
                <div id="poster-node" class="relative w-full max-w-md bg-slate-900 rounded-2xl overflow-hidden shadow-2xl border border-white/10">
                    
                    <div id="poster-container" class="p-8 pb-10 relative">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl pointer-events-none"></div>
                        <div class="absolute bottom-0 left-0 w-64 h-64 bg-purple-500/10 rounded-full blur-3xl pointer-events-none"></div>

                        <div class="flex gap-2 mb-6">
                            <span id="res-mbti" class="px-2 py-1 bg-white/10 text-white text-xs font-bold rounded">...</span>
                            <span id="res-zodiac" class="px-2 py-1 bg-white/10 text-yellow-300 text-xs font-bold rounded">...</span>
                        </div>

                        <h1 class="text-4xl font-black text-white mb-2"><span id="res-title">...</span></h1>
                        <p id="res-subtitle" class="text-lg text-blue-400 mb-6">...</p>

                        <div class="w-full aspect-square max-w-[200px] mx-auto mb-6">
                            <canvas id="radarChart"></canvas>
                        </div>

                        <div class="bg-white/5 p-4 rounded-xl border-l-4 border-blue-500 mb-6">
                            <p id="res-quote" class="text-white text-sm italic">...</p>
                        </div>

                        <div class="flex items-center justify-between border-t border-white/10 pt-4 mt-4">
                            <div class="text-left">
                                <div class="text-sm font-bold text-white">æ‰«ç ç¡®è¯Šä½ çš„</div>
                                <div class="text-xs text-slate-400">2026 èŒåœºæœ¬å‘½äººæ ¼</div>
                            </div>
                            <div id="qrcode" class="p-1 bg-white rounded-lg"></div>
                        </div>
                    </div>

                    <div id="save-mask" class="absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-50 hidden text-center p-6">
                        <img id="final-image" src="" class="w-full rounded-xl shadow-2xl mb-4 border-4 border-white/20">
                        <p class="text-white font-bold text-lg animate-bounce">ğŸ‘† é•¿æŒ‰ä¸Šæ–¹å›¾ç‰‡ä¿å­˜ ğŸ‘†</p>
                        <p class="text-slate-400 text-sm mt-2">å‘æœ‹å‹åœˆé‚€è¯·æœ‹å‹æ¥æµ‹</p>
                        <button onclick="closeMask()" class="mt-6 px-6 py-2 bg-white/10 text-white rounded-full text-sm">å…³é—­é¢„è§ˆ</button>
                    </div>

                </div>
            </div>

            <div class="fixed bottom-8 left-0 right-0 flex justify-center gap-4 z-40">
                <button onclick="location.reload()" class="px-6 py-3 bg-slate-800 text-white rounded-full font-bold shadow-lg">å†æµ‹ä¸€æ¬¡</button>
                <button onclick="generatePoster()" class="px-8 py-3 bg-blue-600 text-white rounded-full font-bold shadow-lg shadow-blue-600/40">ç”Ÿæˆåˆ†äº«æµ·æŠ¥</button>
            </div>
        </div>
    </main>

    <script>
        // ----------------------------------------------------
        // æ ¸å¿ƒé€»è¾‘åŒº (æ•°æ®éƒ¨åˆ†ç›´æ¥å¤ç”¨ä¹‹å‰çš„ï¼Œè¿™é‡Œåªå†™ç”Ÿæˆæµ·æŠ¥çš„æ–°é€»è¾‘)
        // ----------------------------------------------------
        
        // æ­¤å¤„å¡«å…¥ä¹‹å‰å®Œæ•´çš„ questions æ•°ç»„ å’Œ profiles å¯¹è±¡
        // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘åªå†™ä¸€ä¸ªç®€ç‰ˆæ•°æ®ï¼Œè¯·åŠ¡å¿…æŠŠä¹‹å‰ V2 ç‰ˆé‚£ä¸ªé•¿é•¿çš„ questions æ•°ç»„å¤åˆ¶å›æ¥ï¼
        const questions = [
            { q: "æµ‹è¯•é¢˜1ï¼šè€æ¿ç”»é¥¼ï¼Ÿ", a: {t: "åƒä¸ä¸‹", v: "T"}, b: {t: "å‡è£…åƒ", v: "R"} },
            { q: "æµ‹è¯•é¢˜2ï¼šå‘¨æœ«åŠ ç­ï¼Ÿ", a: {t: "ä¸å»", v: "E"}, b: {t: "å»æ··é¥­", v: "I"} }
            // ... è¯·å¤åˆ¶ V2 ç‰ˆæœ¬çš„å®Œæ•´25é¢˜ ...
        ];
        const profiles = {
            "T_E": { title: "é«˜å†·æ“ç›˜æ‰‹", subtitle: "æˆ˜ç•¥å¤§è„‘ Ã— æš´åŠ›æ‰§è¡Œ", mbti: "INTJ", zodiac: "æ‘©ç¾¯åº§", quote: "åˆ«è·Ÿæˆ‘è°ˆæ„Ÿæƒ…ï¼Œç›´æ¥çœ‹æ•°æ®ã€‚" },
            "T_I": { title: "ç”»é¥¼è‰ºæœ¯å®¶", subtitle: "æˆ˜ç•¥ Ã— ç¤¾äº¤", mbti: "ENTJ", zodiac: "ç‹®å­åº§", quote: "å¬æˆ‘çš„ï¼Œè¿™äº‹å„¿èƒ½æˆã€‚" },
            // ... è¯·å¤åˆ¶ V2 ç‰ˆæœ¬çš„å®Œæ•´ profiles ...
            "default": { title: "å…¨èƒ½æ‰“å·¥äºº", subtitle: "å…­è¾¹å½¢æˆ˜å£«", mbti: "ISTJ", zodiac: "é‡‘ç‰›åº§", quote: "æ‰“å·¥é­‚ï¼Œäººä¸Šäººã€‚" } 
        };

        let step = 0;
        let scores = { "T": 0, "E": 0, "I": 0, "R": 0 };

        function startQuiz() { document.getElementById('start-screen').classList.add('hidden'); document.getElementById('quiz-screen').classList.remove('hidden'); renderQ(); }
        function renderQ() {
            if (step >= questions.length) { showResult(); return; } // é˜²æ­¢è¶Šç•Œ
            const q = questions[step];
            document.getElementById('q-index').innerText = step + 1;
            document.getElementById('q-text').innerText = q.q;
            document.getElementById('text-a').innerText = q.a.t;
            document.getElementById('text-b').innerText = q.b.t;
            document.getElementById('progress-bar').style.width = ((step + 1) / questions.length * 100) + '%';
        }
        function selectOption(choice) {
            // ç®€å•è®¡åˆ†é€»è¾‘æ¼”ç¤º
            const val = choice === 'A' ? questions[step].a.v : questions[step].b.v;
            scores[val]++;
            step++;
            renderQ();
        }

        function showResult() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');

            // ç®€å•ç®—å‡ºæœ€é«˜åˆ†é€»è¾‘
            const sorted = Object.entries(scores).sort((a,b) => b[1]-a[1]);
            let key = `${sorted[0][0]}_${sorted[1][0]}`;
            if(!profiles[key]) key = `${sorted[1][0]}_${sorted[0][0]}`;
            const res = profiles[key] || profiles["default"];

            // å¡«å……æ–‡å­—
            document.getElementById('res-title').innerText = res.title;
            document.getElementById('res-subtitle').innerText = res.subtitle;
            document.getElementById('res-mbti').innerText = res.mbti;
            document.getElementById('res-zodiac').innerText = res.zodiac;
            document.getElementById('res-quote').innerText = res.quote;

            // 1. æ¸²æŸ“å›¾è¡¨
            new Chart(document.getElementById('radarChart'), {
                type: 'radar',
                data: {
                    labels: ['æˆ˜ç•¥', 'æ‰§è¡Œ', 'ç¤¾äº¤', 'å…±æƒ…'],
                    datasets: [{ data: [scores.T, scores.E, scores.I, scores.R], borderColor: '#60a5fa', backgroundColor: 'rgba(96, 165, 250, 0.4)', borderWidth: 1, pointRadius: 0 }]
                },
                options: {
                    scales: { r: { angleLines: {color:'rgba(255,255,255,0.1)'}, grid: {color:'rgba(255,255,255,0.1)'}, ticks:{display:false}, pointLabels:{color:'#fff', font:{size:10}} } },
                    plugins: { legend: {display:false} }
                }
            });

            // 2. ç”Ÿæˆè£‚å˜äºŒç»´ç  (æŒ‡å‘å½“å‰é¡µé¢çš„ URL)
            // å®é™…éƒ¨ç½²åï¼Œè¿™é‡Œä¼šè‡ªåŠ¨è·å–æµè§ˆå™¨é‡Œçš„å½“å‰ç½‘å€
            const currentUrl = window.location.href; 
            document.getElementById('qrcode').innerHTML = "";
            new QRCode(document.getElementById("qrcode"), {
                text: currentUrl,
                width: 60,
                height: 60,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }

        // --- æ ¸å¿ƒï¼šæµ·æŠ¥ç”Ÿæˆé€»è¾‘ ---
        function generatePoster() {
            const dom = document.getElementById('poster-node');
            
            // ä¸´æ—¶è°ƒæ•´æ ·å¼ä»¥ä¿è¯æˆªå›¾æ¸…æ™°
            window.scrollTo(0,0); 
            
            html2canvas(dom, {
                backgroundColor: null, // é€æ˜èƒŒæ™¯
                scale: 2, // 2å€æ¸…æ™°åº¦
                useCORS: true // å…è®¸è·¨åŸŸå›¾ç‰‡(å¦‚æœæœ‰)
            }).then(canvas => {
                // è½¬æˆå›¾ç‰‡
                const imgData = canvas.toDataURL('image/png');
                
                // æ˜¾ç¤ºé®ç½©å±‚
                document.getElementById('final-image').src = imgData;
                document.getElementById('save-mask').classList.remove('hidden');
                document.getElementById('save-mask').classList.add('flex');
            });
        }

        function closeMask() {
            document.getElementById('save-mask').classList.add('hidden');
            document.getElementById('save-mask').classList.remove('flex');
        }
    </script>
</body>
</html>